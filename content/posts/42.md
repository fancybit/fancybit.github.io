---
title: devexpress entity framework 与 asp.net mvc的坑
date: '2025-06-29T15:37:37.483Z'
author: fancybit
draft: false
---
<div class="header"><h1 class="single-title animate__animated animate__pulse animate__faster">devexpress entity framework 与 asp.net mvc的坑</h1></div>

<div class="content" id="content"><p>最近在做一个使用ASP.NET MVC DEVEXPRESS和EF的OA模块 遇到不少问题这里记录一下：</p><p>1 如果项目中存在多个上下文类（DBContext的派生类），在做数据迁移的时候需要在不同目录下和对应类名分别启用Migration，具体指令可以参考:</p><p>　http://www.cnblogs.com/Jack-Blog/p/4699596.html?ptvd</p><p></p><ul><li><!-- raw HTML omitted -->通过Migration在EF6中用多个DbContext<!-- raw HTML omitted --><ul><li><!-- raw HTML omitted -->前言<!-- raw HTML omitted --></li><li><!-- raw HTML omitted -->实现目标<!-- raw HTML omitted --></li><li><!-- raw HTML omitted -->设置多数据上下文<!-- raw HTML omitted --></li><li><!-- raw HTML omitted -->更新数据脚本<!-- raw HTML omitted --></li><li><!-- raw HTML omitted -->参考资料<!-- raw HTML omitted --></li></ul></li></ul><p></p><p></p><h2 id="前言">前言</h2><p>本人在阿里云申请了个免费的空间,之前已经存放了一个项目,由于之前一直没时间,近期比较有空,所以想开发个个人博客,但是由于阿里云没有给我们权限来新建数据库,因此只能在原有的数据库另外“瓜分”一部分空间来做个人博客的数据库,我是在之前的_JackSite.Entities_实体项目上开发,因此只需要在定义一个_DbContext_即可。</p><blockquote><p><strong>PS</strong>:<strong>本次讨论的使用范围</strong>：<!-- raw HTML omitted -->通过EF6(低版本是否支持多数据上下文我并不了解)用一个数据库构造多个<!-- raw HTML omitted -->DbContext<!-- raw HTML omitted --><!-- raw HTML omitted --></p></blockquote><p></p><h2 id="实现目标p">实现目标<!-- raw HTML omitted --></h2><blockquote><p>原本默认_Migration_的文件是在_Migrations_,我现在希望已如下的形式来存放</p></blockquote><p>在_Migrations_项目中添加文件夹_AMigration,BMigration_文件来区分不同的_DbContext_迁移文件。</p><p></p><h2 id="设置多数据上下文">设置多数据上下文</h2><p>首先我查找了下资料并未发现有类似<code>Move-Migrations</code>或者<code>Update-Migrations</code>的命令,因此我设想是是否同样是通过<code>Enable-Migrations</code>进行设置&nbsp;<br> 通过google 搜索关键字_Single Database Multiple DbContext_&nbsp;搜到确实和我想象的一致都是通过此命令来设置多个数据库上下文的迁移文件路径 在抱着试试看的态度,进行了如下命令输入：</p><p></p><ol><li><code>&lt;span&gt;&lt;span&gt;Enable&lt;span&gt;&lt;span&gt;-&lt;span&gt;&lt;span&gt;Migrations&lt;span&gt; &lt;span&gt;&lt;span&gt;-&lt;span&gt;&lt;span&gt;ContextTypeName&lt;span&gt;&lt;span&gt;:&lt;span&gt;&lt;span&gt;JackSite&lt;span&gt;&lt;span&gt;.&lt;span&gt;&lt;span&gt;Entities&lt;span&gt;&lt;span&gt;.&lt;span&gt;&lt;span&gt;Models&lt;span&gt;&lt;span&gt;.&lt;span&gt;&lt;span&gt;StudyTime&lt;span&gt;&lt;span&gt;.&lt;span&gt;&lt;span&gt;JackDbContext&lt;span&gt; &lt;span&gt;&lt;span&gt;-&lt;span&gt;&lt;span&gt;MigrationsDirectory&lt;span&gt;&lt;span&gt;:&lt;span&gt;&lt;span&gt;Migrations&lt;span&gt;\&lt;span&gt;StudyTimeMigrations&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;</code></li></ol><blockquote><p><strong>ContextTypeName</strong>：_DbContext_的位置,即DbContext的命名空间加上DbContext的名称&nbsp;<br><strong>MigrationsDirectory</strong>：需要迁移到的目标文件夹&nbsp;<br><strong>PS</strong>:注意<code>MigrationsDirectory:Migrations\StudyTimeMigrations</code>中的’'不要打错如输成’/‘可能会引发一些问题&nbsp;<br> 同样我们对另一个数据上下文进行设置</p></blockquote><p></p><ol><li><code>&lt;span&gt;&lt;span&gt;Enable&lt;span&gt;&lt;span&gt;-&lt;span&gt;&lt;span&gt;Migrations&lt;span&gt; &lt;span&gt;&lt;span&gt;-&lt;span&gt;&lt;span&gt;ContextTypeName&lt;span&gt;&lt;span&gt;:&lt;span&gt;&lt;span&gt;JackSite&lt;span&gt;&lt;span&gt;.&lt;span&gt;&lt;span&gt;Entities&lt;span&gt;&lt;span&gt;.&lt;span&gt;&lt;span&gt;Models&lt;span&gt;&lt;span&gt;.&lt;span&gt;&lt;span&gt;Blog&lt;span&gt;&lt;span&gt;.&lt;span&gt;&lt;span&gt;BlogDbContext&lt;span&gt; &lt;span&gt;&lt;span&gt;-&lt;span&gt;&lt;span&gt;MigrationsDirectory&lt;span&gt;&lt;span&gt;:&lt;span&gt;&lt;span&gt;Migrations&lt;span&gt;\&lt;span&gt;BlogMigrations&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;</code></li></ol><blockquote><p><strong>PS</strong>:这里两个_DbContext_用的是同样的连接串</p></blockquote><p></p><h2 id="更新数据脚本">更新数据脚本</h2><p>最后通过运行<code>Add-Migrations</code>命令</p><blockquote><p>这里需要注意：如果我们只有一个数据上下文,通过<code>Add-Migrations</code>命令会自动选择唯一的_DbContext_,但是如果有多个_DbContext_,我们必须指定我们需要对那个_DbContext_进行修改</p></blockquote><p></p><ol><li><code>&lt;span&gt;&lt;span&gt;Add&lt;span&gt;&lt;span&gt;-&lt;span&gt;&lt;span&gt;Migration&lt;span&gt; &lt;span&gt;&lt;span&gt;-&lt;span&gt;&lt;span&gt;ConfigurationTypeName&lt;span&gt; &lt;span&gt;&lt;span&gt;JackSite&lt;span&gt;.&lt;span&gt;Entities&lt;span&gt;.&lt;span&gt;Migrations&lt;span&gt;.&lt;span&gt;BlogMigrations&lt;span&gt;.&lt;span&gt;Configuration&lt;span&gt; &lt;span&gt;&lt;span&gt;InitBlogDb&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;</code></li></ol><p>这里通过<code>-ConfigurationTypeName</code>指定_Configuration_&nbsp;后面接着是_Configuration_的路径,然后接着是我们取得名字_InitBlogDb_&nbsp;<br> EF会找到指定的Configuration,并添加XXXX_InitBlogDb,结构如下图所示:</p><p><br> 最后通过<code>Update-Database</code>进行更新</p><blockquote><p>同样,我们这里需要指定需要更新哪个_Configuration_</p></blockquote><p></p><ol><li><code>&lt;span&gt;&lt;span&gt;Update&lt;span&gt;&lt;span&gt;-&lt;span&gt;&lt;span&gt;Database&lt;span&gt; &lt;span&gt;&lt;span&gt;JackSite&lt;span&gt;.&lt;span&gt;Entities&lt;span&gt;.&lt;span&gt;Migrations&lt;span&gt;.&lt;span&gt;BlogMigrations&lt;span&gt;.&lt;span&gt;Configuration&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;</code></li></ol><p> 2 使用EF和ASP.NET MVC的时候，如果视图中没有绑定KEY，需要用一个Html.HiddenFor(m=&gt;m.key)来绑定主键，这样方便在后续post回发中获取对象的key。然后由于ASP.NET是短连接，回发的model是重新创建的detached状态，需要重新attach到DbContext才能正确更新。 3 DEVEXPRESS的文件上传控件不适合asp.net mvc的附件随表单上传，直接用input type=file上传更简单方便，另外上传文件的表单form要加enctype=“multipart/form-data"属性，并且input type=file元素要有不同的name属性，否则服务端会收不到上传的文件。</p><p>未完待续…</p><p>,</p><ul><li><!-- raw HTML omitted -->通过Migration在EF6中用多个DbContext<!-- raw HTML omitted --><ul><li><!-- raw HTML omitted -->前言<!-- raw HTML omitted --></li><li><!-- raw HTML omitted -->实现目标<!-- raw HTML omitted --></li><li><!-- raw HTML omitted -->设置多数据上下文<!-- raw HTML omitted --></li><li><!-- raw HTML omitted -->更新数据脚本<!-- raw HTML omitted --></li><li><!-- raw HTML omitted -->参考资料<!-- raw HTML omitted --></li></ul></li></ul><p></p><p></p><h2 id="前言-1">前言</h2><p>本人在阿里云申请了个免费的空间,之前已经存放了一个项目,由于之前一直没时间,近期比较有空,所以想开发个个人博客,但是由于阿里云没有给我们权限来新建数据库,因此只能在原有的数据库另外“瓜分”一部分空间来做个人博客的数据库,我是在之前的_JackSite.Entities_实体项目上开发,因此只需要在定义一个_DbContext_即可。</p><blockquote><p><strong>PS</strong>:<strong>本次讨论的使用范围</strong>：<!-- raw HTML omitted -->通过EF6(低版本是否支持多数据上下文我并不了解)用一个数据库构造多个<!-- raw HTML omitted -->DbContext<!-- raw HTML omitted --><!-- raw HTML omitted --></p></blockquote><p></p><h2 id="实现目标p-1">实现目标<!-- raw HTML omitted --></h2><blockquote><p>原本默认_Migration_的文件是在_Migrations_,我现在希望已如下的形式来存放</p></blockquote><p>在_Migrations_项目中添加文件夹_AMigration,BMigration_文件来区分不同的_DbContext_迁移文件。</p><p></p><h2 id="设置多数据上下文-1">设置多数据上下文</h2><p>首先我查找了下资料并未发现有类似<code>Move-Migrations</code>或者<code>Update-Migrations</code>的命令,因此我设想是是否同样是通过<code>Enable-Migrations</code>进行设置&nbsp;<br> 通过google 搜索关键字_Single Database Multiple DbContext_&nbsp;搜到确实和我想象的一致都是通过此命令来设置多个数据库上下文的迁移文件路径 在抱着试试看的态度,进行了如下命令输入：</p><p></p><ol><li><code>&lt;span&gt;&lt;span&gt;Enable&lt;span&gt;&lt;span&gt;-&lt;span&gt;&lt;span&gt;Migrations&lt;span&gt; &lt;span&gt;&lt;span&gt;-&lt;span&gt;&lt;span&gt;ContextTypeName&lt;span&gt;&lt;span&gt;:&lt;span&gt;&lt;span&gt;JackSite&lt;span&gt;&lt;span&gt;.&lt;span&gt;&lt;span&gt;Entities&lt;span&gt;&lt;span&gt;.&lt;span&gt;&lt;span&gt;Models&lt;span&gt;&lt;span&gt;.&lt;span&gt;&lt;span&gt;StudyTime&lt;span&gt;&lt;span&gt;.&lt;span&gt;&lt;span&gt;JackDbContext&lt;span&gt; &lt;span&gt;&lt;span&gt;-&lt;span&gt;&lt;span&gt;MigrationsDirectory&lt;span&gt;&lt;span&gt;:&lt;span&gt;&lt;span&gt;Migrations&lt;span&gt;\&lt;span&gt;StudyTimeMigrations&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;</code></li></ol><blockquote><p><strong>ContextTypeName</strong>：_DbContext_的位置,即DbContext的命名空间加上DbContext的名称&nbsp;<br><strong>MigrationsDirectory</strong>：需要迁移到的目标文件夹&nbsp;<br><strong>PS</strong>:注意<code>MigrationsDirectory:Migrations\StudyTimeMigrations</code>中的’'不要打错如输成’/‘可能会引发一些问题&nbsp;<br> 同样我们对另一个数据上下文进行设置</p></blockquote><p></p><ol><li><code>&lt;span&gt;&lt;span&gt;Enable&lt;span&gt;&lt;span&gt;-&lt;span&gt;&lt;span&gt;Migrations&lt;span&gt; &lt;span&gt;&lt;span&gt;-&lt;span&gt;&lt;span&gt;ContextTypeName&lt;span&gt;&lt;span&gt;:&lt;span&gt;&lt;span&gt;JackSite&lt;span&gt;&lt;span&gt;.&lt;span&gt;&lt;span&gt;Entities&lt;span&gt;&lt;span&gt;.&lt;span&gt;&lt;span&gt;Models&lt;span&gt;&lt;span&gt;.&lt;span&gt;&lt;span&gt;Blog&lt;span&gt;&lt;span&gt;.&lt;span&gt;&lt;span&gt;BlogDbContext&lt;span&gt; &lt;span&gt;&lt;span&gt;-&lt;span&gt;&lt;span&gt;MigrationsDirectory&lt;span&gt;&lt;span&gt;:&lt;span&gt;&lt;span&gt;Migrations&lt;span&gt;\&lt;span&gt;BlogMigrations&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;</code></li></ol><blockquote><p><strong>PS</strong>:这里两个_DbContext_用的是同样的连接串</p></blockquote><p></p><h2 id="更新数据脚本-1">更新数据脚本</h2><p>最后通过运行<code>Add-Migrations</code>命令</p><blockquote><p>这里需要注意：如果我们只有一个数据上下文,通过<code>Add-Migrations</code>命令会自动选择唯一的_DbContext_,但是如果有多个_DbContext_,我们必须指定我们需要对那个_DbContext_进行修改</p></blockquote><p></p><ol><li><code>&lt;span&gt;&lt;span&gt;Add&lt;span&gt;&lt;span&gt;-&lt;span&gt;&lt;span&gt;Migration&lt;span&gt; &lt;span&gt;&lt;span&gt;-&lt;span&gt;&lt;span&gt;ConfigurationTypeName&lt;span&gt; &lt;span&gt;&lt;span&gt;JackSite&lt;span&gt;.&lt;span&gt;Entities&lt;span&gt;.&lt;span&gt;Migrations&lt;span&gt;.&lt;span&gt;BlogMigrations&lt;span&gt;.&lt;span&gt;Configuration&lt;span&gt; &lt;span&gt;&lt;span&gt;InitBlogDb&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;</code></li></ol><p>这里通过<code>-ConfigurationTypeName</code>指定_Configuration_&nbsp;后面接着是_Configuration_的路径,然后接着是我们取得名字_InitBlogDb_&nbsp;<br> EF会找到指定的Configuration,并添加XXXX_InitBlogDb,结构如下图所示:</p><p><br> 最后通过<code>Update-Database</code>进行更新</p><blockquote><p>同样,我们这里需要指定需要更新哪个_Configuration_</p></blockquote><p></p><ol><li><code>&lt;span&gt;&lt;span&gt;Update&lt;span&gt;&lt;span&gt;-&lt;span&gt;&lt;span&gt;Database&lt;span&gt; &lt;span&gt;&lt;span&gt;JackSite&lt;span&gt;.&lt;span&gt;Entities&lt;span&gt;.&lt;span&gt;Migrations&lt;span&gt;.&lt;span&gt;BlogMigrations&lt;span&gt;.&lt;span&gt;Configuration&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;</code></li></ol><p> 2 使用EF和ASP.NET MVC的时候，如果视图中没有绑定KEY，需要用一个Html.HiddenFor(m=&gt;m.key)来绑定主键，这样方便在后续post回发中获取对象的key。然后由于ASP.NET是短连接，回发的model是重新创建的detached状态，需要重新attach到DbContext才能正确更新。 3 DEVEXPRESS的文件上传控件不适合asp.net mvc的附件随表单上传，直接用input type=file上传更简单方便，另外上传文件的表单form要加enctype=“multipart/form-data"属性，并且input type=file元素要有不同的name属性，否则服务端会收不到上传的文件。<!-- raw HTML omitted --></p></div>

